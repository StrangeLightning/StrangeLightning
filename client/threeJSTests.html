<html>
  <head>
    <title>Three.JS Test for Sphereable 3D environment</title>
  </head>
  <body>
    <div id="container"></div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js"></script>
  <script src="TrackballControls.js"></script>
  <script>


  var camera;
  var controls;
  var scene;
  var renderer;
  var mesh;
  var light;
  var hemiLight;


  // Camera
  camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
  // Set height
  camera.position.z = 1000;

  // Camera controls
  controls = new THREE.TrackballControls( camera );
  controls.rotateSpeed = 1.0;
  controls.zoomSpeed = 1.2;
  controls.panSpeed = 0.8;
  controls.noZoom = false;
  controls.noSpan = false;
  controls.staticMoving = true;
  controls.dynamicDampingFactor = 0.3;

  // Move with keys
  controls.keys = [ 65, 83, 68 ];

  controls.addEventListener( 'change', render );

  // Create a new scene
  scene = new THREE.Scene();

  // Directional Light
  light = new THREE.DirectionalLight( 0xffffff, 1);
  light.position.set(1,1,100).normalize();
  // Add light to scene
  scene.add( light );

  // Project shadow to ground - (require ground to work)
  light.castShadow = true;

  light.shadowMapWidth = 2048;
  light.shadowMapHeight = 2048;

  var d = 50;

  light.shadowCameraLeft = -d;
  light.shadowCameraRight = d;
  light.shadowCameraTop = d;
  light.shadowCameraBottom = -d;

  light.shadowCameraFar = 3500;
  light.shadowBias = -0.0001;
  light.shadowDarkness = 0.35;
  // light.shadowCameraVisible = true;
  
/*
  // Hemisphere Light - for softer shadows
  hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
  // H: Hue (between 0.0 and 1.0), S: Saturation (0.0 - 1.0), L: Lightness (0.0 - 1.0)
  hemiLight.color.setHSL( 0.6, 1, 0.6);
  hemiLight.groundColor.setHSL( 0.095, 1, 0.75);
  // Set high 'y' value for light position
  hemiLight.position.set( 0, 500, 0);
  scene.add( hemiLight );
*/

  // Create a ground plane
  var groundGeometry = new THREE.PlaneBufferGeometry(10000, 10000);
  var groundMaterial = new THREE.MeshPhongMaterial({ ambient: 0xffffff, color: 0xffffff, specular: 0x050505 });
  groundMaterial.color.setHSL( 0.095, 1, 0.75 );

  var ground = new THREE.Mesh( groundGeometry, groundMaterial );
  // ground.rotation.x = -Math.PI/2;
  ground.position.y = -33;
  // ground.position.z = 100;

  scene.add( ground );

  ground.receiveShadow = true;
  

  // Set a geometry for the object
  var geometry = new THREE.BoxGeometry(20,20,20);

  for(var i = 0; i<100; i++){

    //  Mesh the created geometry
    var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial({ color: Math.random() * 0xFFFFFF }) );

    object.position.x = Math.random() * 800 - 400;
    object.position.y = Math.random() * 800 - 400;
    object.position.z = Math.random() * 800;

    object.rotation.x = Math.random() * 2 * Math.PI;
    object.rotation.y = Math.random() * 2 * Math.PI;
    object.rotation.z = Math.random() * 2 * Math.PI;

    object.scale.x = Math.random() + 0.5;
    object.scale.y = Math.random() + 0.5;
    object.scale.z = Math.random() + 0.5;
    
    // Add each item in scene
    scene.add( object );
  }


  // Renderer
  renderer = new THREE.WebGLRenderer( { antialias: true } );
  // Adapt pixelization to screen resolution
  renderer.setPixelRatio( window.devicePixelRatio );
  // Set background color
  renderer.setClearColor( 0xFFFFFF );
  // Stretch renderer to window size
  renderer.setSize( window.innerWidth, window.innerHeight );

  document.body.appendChild(renderer.domElement);

  animate();

  // Update image after every manipulation
  function animate(){
    requestAnimationFrame( animate );
    controls.update();
  }

  function render(){
    // Render scene
    renderer.render(scene, camera);
}

  </script>
</html>
